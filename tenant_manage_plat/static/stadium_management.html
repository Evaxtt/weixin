<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="title" content="Bootstrap可视化布局系统">
	<meta name="description" content="">
	<meta name="keywords" content="场地管理">
	<title>场地管理</title>
	<link href="./css/bootstrap-combined.min.css" rel="stylesheet">
	<link href="./css/layoutit.css" rel="stylesheet">
	<link href="./css/notice.css" rel="stylesheet">
	<link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="./css/activity.css">
	<!--[if lt IE 9]>
			<script src="js/html5shiv.js"></script>
		<![endif]-->
	<link rel="shortcut icon" href="img/favicon.png">
	<script type="text/javascript" src="./js/jquery-2.1.4.js"></script>
	<script type="text/javascript" src="./js/jquery.form.js"></script>
	<!--[if lt IE 9]>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<![endif]-->
	<script type="text/javascript" src="./js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/jquery-ui.js"></script>
	<script type="text/javascript" src="./js/jquery.ui.touch-punch.min.js"></script>
	<script type="text/javascript" src="./js/jquery.htmlClean.js"></script>
	
	<script type="text/javascript" src="./js/confirm/jquery-confirm.min.js"></script>
	<link href="./js/confirm/jquery-confirm.min.css" rel="stylesheet">
	
	<script type="text/javascript" src="./js/common.js"></script>
	
	<link href="./js/mCustomScrollbar/jquery.mCustomScrollbar.min.css" rel="stylesheet" type="text/css" />
	<script src="./js/mCustomScrollbar/jquery.mousewheel.min.js"></script>
	<script src="./js/mCustomScrollbar/jquery.mCustomScrollbar.min.js"></script>
	
	
	
	<style type="text/css">
	
	</style>
</head>



<script>
	(function($){
        $(window).load(function(){
            //$(".custom_scrollbar").mCustomScrollbar();
			$(".container").mCustomScrollbar({
				axis:"y", // horizontal scrollbar
				theme:"3d-dark"
			});
			
        });		
		
    })(jQuery);

	$(document).ready(function(){
		query()
	})
	
	function query(){	
		$("#loadingCover").show()
		$("#stadium_list").empty()
		var data = {}
		$.ajax({
			url:'/stadium/list/',
			type:'POST',
			data:JSON.stringify(data),
			dataType:'json',
			success:function(result){
				if (result.error == 0){
					var html=[]
					var list = result.stadium_list
					for (var i=0;i<list.length;i++){
						html.push('<tr id="' + list[i].id + '"><td><input type="checkbox"></input></td>')
						html.push('<td class="name">' + list[i].name + '</td>')
						//html.push('<td>' + list[i].category + '</td>')
						html.push('<td class="address">' + list[i].address + '</td>')
						html.push('<td class="contact">' + list[i].contact + '</td>')
						html.push('<td class="facility">' + list[i].facility + '</td>')
						html.push('<td class="telephone">' + list[i].telephone + '</td></tr>')						
					}
					$("#loadingCover").hide()
					$("#stadium_list").append(html.join(''))
				}else{
					$("#loadingCover").hide()
					$(".qb_quick_tip").css('background','#e96262')
					showBubble("获取信息失败")
				}			
				},error:function (XMLHttpRequest, textStatus, errorThrown)  {
					$("#loadingCover").hide()
					$(".qb_quick_tip").css('background','#e96262')
					showBubble("获取信息失败")
				}
		
		})
	
	}
	
	
</script>
<body style="cursor: auto;">

<div class="container-fluid">
	<div class="row-fluid">
		<div class="span12"  style="background-color:#FF9933;margin-bottom:20px;height:60px;">
			<div class="row-fluid">
				<div class="span3" style="margin-left:0 !important;height:60px;">
					<a href="#" style="background:url('./img/logo.jpg') 50% 50% no-repeat;width:300px;height:60px;float:left;display:inline">
						
					</a>
				</div>
				<div class="span7" style="height:30px;">
						<ul class="breadcrumb" >
							<li style="min-width:120px;">
								<a href="/sport/reserve_management.html">
									预定管理
								</a>
							</li>							
							<li style="min-width:120px;" >
								<a href="/sport/activity_management.html">
									活动管理
								</a>
							</li>
							<li style="min-width:120px;">
								<a href="/sport/stadium_management.html"  style="color:#555 !important">									
									基础配置
								</a>
							</li>
							<li style="min-width:120px;">
								<a href="/sport/marketing_activity.html" style="color:#555">	
									营销活动
								</a>
							</li>							
							<li style="min-width:120px;">
								<a href="/sport/vip_ifo.html" style="color:#555">								
									会员信息
								</a>
							</li>							
							<!--<li style="min-width:120px;">
								<a href="#">
									数据中心
								</a>
							</li>-->										
						</ul>
				</div>
				<div class="span2" style="height:30px;">	
						<ul class="breadcrumb" >
							<li class="active">
								<a href="#" id="user_name">
									admin
								</a>
								<b>|</b>
								<a href="#" id="login_out">
									注销
								</a>
							</li>
						</ul>
					</div>	
			</div>
		</div>
	</div>
</div>
<div class="container-fluid">
<!-- 			<div class="row-fluid" style="margin-bottom:30px;border-bottom:1px solid #e6e7ec;margin-top:10px;position:relative">
				<div class="span1">
				</div>
				<div class="span11">
					<ul style="line-height:30px;height:31px;margin:0;padding:0">
					<li style="line-height:30px;float:left;">
						<a href="/stadium/stadium_management.html" style="color:#FF9933;border-bottom:2px solid #FF9933;text-align:center;display:block;font-size:15px;">基础配置</a>
					</li>
					</ul>
				</div>
			</div> -->
			<div class="content-main">
				<div class="sub-nav">
					<ul class="nav nav-pills">
								
						<li class="active">
							<a href="/sport/stadium_management.html">
								<!-- <i class="icon-chevron-right"></i> -->
								场馆管理
							</a>
						</li>
						<li >
							<a href="/sport/place_management.html">
								<!-- <i class="icon-chevron-right"></i> -->
								场地管理
							</a>
						</li>
						<li>
							<a href="/sport/price_management.html">
								<!-- <i class="icon-chevron-right"></i> -->
								价格管理
							</a>
						</li>
						<li>
							<a href="/sport/account_management.html">
								<!-- <i class="icon-chevron-right"></i> -->
								账号管理
							</a>
						</li>
								
					</ul>
				</div>
				<div class="span12 radius">
							<div class="span11 tablespan">
							<table class="table table-striped" style="height:auto;border-bottom:1px solid #dddddd">
								<thead>
									<tr>
										<th>
											<input onclick="checkbox_all(this)" type="checkbox"></input>
										</th>
										<th>
											场馆名称
										</th>
										<!--<th>
											场馆类型
										</th>-->
										<th>
											地址
										</th>
										<th>
											联系人
										</th>
										<th>
											配套设施
										</th>
										<th>
											电话
										</th>
									</tr>
								</thead>
								<tbody id="stadium_list">
							
								</tbody>
							</table>
							<div class="row-fluid" style="margin-top:55px;">
								
								<div class="span4 buttonspan">
									 <button class="btn-new" type="button" onclick="openAdd()">新增</button>
								</div>
								<div class="span4 buttonspan">
									 <button class="btn-new" type="button" onclick="openModify()">编辑</button>
								</div>
								<div class="span4 buttonspan">
									 <button class="btn-new" type="button" onclick="del()">删除</button>
								</div>
							</div>
							</div>
						</div>
				<div class="span1">
				</div>
			</div>
		</div>
	</div>
</div>


<div class="modal hide fade" id="add_new" tabindex="-1" role="dialog">
<div class="modal-header"><button class="close" type="button" data-dismiss="modal" onclick="$('#add_new').modal('hide');query()">×</button>
<h3 id="myModalLabel" style="font-family:'微软雅黑'">新增场馆</h3>
</div>
<div class="modal-body">
	<div class="container" style="height:370px;width:450px;overflow:auto;margin-bottom:20px;">
	<form method="post" id="add_form" action="/stadium/add/"  method="post" enctype="multipart/form-data" onsubmit="return addStadium();">
	<input type="hidden" name="tenant" value='1'>
	<input type="hidden" name="area" value='110106'>
	<div style="margin-top:15px;">
	
		<table class="table_async" style="height:auto;border:none">
			<tbody>
				
				<tr>
					<td>场馆名称</td>
					<td><input name="name" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<!--<tr>
					<td>场馆类型</td>
					<td><input name="category" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>-->
				<tr>
					<td>联系人</td>
					<td><input name="contact" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>联系电话</td>
					<td><input name="telephone" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>详细地址</td>
					<td><input name="address" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>配套设施</td>
					<td><input name="facility" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>展示图片</td>
					<td><input type="file" name="img" style="margin-bottom:0px;height:auto;width:206px;"></input></td>
				</tr>
				
			</tbody>
		</table>
	
	</div>
	<div class="row-fluid" style="margin-top:15px;text-align:center">
		<div class="span1 buttonspan" style="width:170px !important;display:inline-block;margin-left:40px;">
			<button class="btn-new" type="submit" >确认</button>
		</div>
		<div class="span1 buttonspan" style="width:170px !important;display:inline-block">
			 <button class="btn-new" type="button" style="background-color:#dedede;color:#000" onclick="$('#add_new').modal('hide');query()">取消</button>
		</div>
	</div>
 </form>
	
	</div>
</div>
</div>


<div class="modal hide fade" id="modify" tabindex="-1" role="dialog">
<div class="modal-header"><button class="close" type="button" data-dismiss="modal" onclick="$('#modify').modal('hide');query()">×</button>
<h3 id="myModalLabel" style="font-family:'微软雅黑'">编辑场馆</h3>
</div>
<div class="modal-body">
	<div class="container" style="height:370px;width:450px;overflow:auto;margin-bottom:20px;">
	<form method="post" id="modify_form" action="/stadium/edit/"  method="post" enctype="multipart/form-data" onsubmit="return modifyStadium();">
	<input type="hidden" name="tenant" value='1'>
	<input type="hidden" name="area" value='110106'>
	<input type="hidden" name="id">
	<div style="margin-top:15px;">
	
		<table class="table_async" style="height:auto;border:none">
			<tbody>
				
				<tr>
					<td>场馆名称</td>
					<td><input name="name" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<!--<tr>
					<td>场馆类型</td>
					<td><input name="category" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>-->
				<tr>
					<td>联系人</td>
					<td><input name="contact" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>联系电话</td>
					<td><input name="telephone" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>详细地址</td>
					<td><input name="address" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>配套设施</td>
					<td><input name="facility" type="text" style="margin-bottom:0px;height:auto"></input></td>
				</tr>
				<tr>
					<td>展示图片</td>
					<td><input type="file" name="img" style="margin-bottom:0px;height:auto;width:206px;"></input></td>
				</tr>
				
			</tbody>
		</table>
	
	</div>
	<div class="row-fluid" style="margin-top:15px;text-align:center">
		<div class="span1 buttonspan" style="width:170px !important;display:inline-block;margin-left:40px;">
			<button class="btn-new" type="submit" >确认</button>
		</div>
		<div class="span1 buttonspan" style="width:170px !important;display:inline-block">
			 <button class="btn-new" type="button" style="background-color:#dedede;color:#000" onclick="$('#modify').modal('hide');query()">取消</button>
		</div>
	</div>
 </form>
	
	</div>
</div>
</div>

<div id="loadingCover">
        <p><img src="./img/loading.gif"/><span>请稍后</span></p>
 </div>
<div class="qb_quick_tip qb_none" id="bubble"></div>
<script>
	$(document).ready(function(){
		//获取session的登录用户信息		
		$.ajax({
			url:"/user/get_login_info",
	        dataType:'JSON',
	        type: 'GET',
	        success:function(result){
	        	if (result.error == "0") {
	        		var login_info = result.login_info;
	        		var user_name = login_info.user;
	        		$("#user_name").text(user_name);
	        	}else if(result.error == "1"){
	        		window.location.href="/sport/login.html"
	        	}else{
	        		alert("internal error!")
	        	}
	        },
	        error:function(e){
	        	alert("this error")
	        }
		})	

		$("#login_out").click(function(){
			$.ajax({
				url:"/login_out/",
	            dataType:'JSON',
	            type: 'GET',
	            success:function(result){
	            	if (result.error == "0") {
	            		window.location.href="/sport/login.html"
	            	}else{
	        			alert("注销失败！")
	        		}
	            },
	            error:function(e){
	            	alert("error")
	            }
			})	
		})
	})		
	
	function openAdd(){
		$(".table_async").find("input").val('')
		$('#add_new').modal('show');	
	}
	
	function openModify(){
		$(".table_async").find("input").val('')
		
		var ids = []
		$("#stadium_list tr").find('input[type="checkbox"]:checked').each(function(){
			ids.push($(this).closest('tr').attr('id'))
		})
		if (ids.length > 1){
			$(".qb_quick_tip").css('background','#e96262')
			showBubble("一次只能编辑一条记录")
		}else if (ids.length == 0){
			$(".qb_quick_tip").css('background','#e96262')
			showBubble("请选择要编辑的记录")
		}else{
			var that = $("#stadium_list tr").find('input[type="checkbox"]:checked')
			var id = ids[0]
			var name = $(that).closest('tr').find('.name').html()
			var contact = $(that).closest('tr').find('.contact').html()
			var telephone = $(that).closest('tr').find('.telephone').html()
			var address = $(that).closest('tr').find('.address').html()
			var facility = $(that).closest('tr').find('.facility').html()
			$("input[name='id']").val(id)
			$("input[name='name']").val(name)
			$("input[name='contact']").val(contact)
			$("input[name='telephone']").val(telephone)
			$("input[name='address']").val(address)
			$("input[name='facility']").val(facility)
			$('#modify').modal('show');	
		}
		
		
	}
	
	
	function addStadium(){
		$("#add_form").ajaxSubmit(function(result) {
			result = JSON.parse(result)
			$("#result").hide()
			$("result_text").html("")
			if (result.error == 0){
				$(".qb_quick_tip").css('background','#44b549')
				showBubble("添加成功")
			}else{
				$(".qb_quick_tip").css('background','#e96262')
				showBubble("添加失败")
			}
		})
		return false
	}
	
	function modifyStadium(){
		$("#modify_form").ajaxSubmit(function(result) {
			result = JSON.parse(result)
			$("#result").hide()
			$("result_text").html("")
			if (result.error == 0){
				$(".qb_quick_tip").css('background','#44b549')
				showBubble("修改成功")
			}else{
				$(".qb_quick_tip").css('background','#e96262')
				showBubble("修改失败")
			}
		})
		return false
	}
	
	function del(){	
		var ids = []
		$("#stadium_list tr").find('input[type="checkbox"]:checked').each(function(){
			ids.push($(this).closest('tr').attr('id'))
		})
		if (ids.length == 0){
			$(".qb_quick_tip").css('background','#e96262')
			showBubble("请选择要删除的记录")
		}else{
			$.confirm({
				title: ' ',
				content: '确定要删除所选记录么',
				confirmButton: '确认',
				cancelButton: '取消',
				confirmButtonClass: 'btn-warning',
				confirm: function(){
					$.ajax({
						url:'/stadium/delete/',
						type:'POST',
						data:JSON.stringify({'ids':ids}),
						dataType:'json',
						success:function(result){
							if (result.error == 0){
								$(".qb_quick_tip").css('background','#44b549')
								showBubble('删除成功')
								$("#stadium_list tr").find('input[type="checkbox"]:checked').closest('tr').remove()
							}else{
								$(".qb_quick_tip").css('background','#e96262')
								showBubble("删除失败")
							}			
							},error:function (XMLHttpRequest, textStatus, errorThrown)  {
								$(".qb_quick_tip").css('background','#e96262')
								showBubble("删除失败")
							}
					
					})
				}
			});
		
			
		}
	}
	
	var timeout
	function showBubble(a) {
		var c = $("#bubble");
			c.css("opacity", 1), c.hasClass("qb_none") || c.html(a), c.html(a).removeClass("qb_none")
			timeout = 	setTimeout("disapper()", 1300 )
	}

	function disapper(){
		$("#bubble").addClass("qb_none").removeAttr("style")
		clearTimeout(timeout)
	}	
</script>
</body>
</html>